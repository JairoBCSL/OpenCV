= Programas de PDI

= 2. Manipulação de pixels de uma imagem

== 2.2. Exercício

=== 2.2.1. Regions.cpp

Esse exercício consiste em tornar negativa uma região definida como parâmetro de uma imagem de entrada também fornecida como parâmetro. O exemplo usou a image do link:/imagens/biel.png[*_Biel_*] e os vértices opostos (100,100) e (200,200) que formarão a região retangular a ser negativada.

O código fonte do programa pode ser visto abaixo: link:/codes/regions.cpp[regions.cpp]

[source,cpp]
----
//make regions
//./regions nome_imagem xmin ymin xmax ymax
#include <iostream>
#include <opencv2/opencv.hpp>
using namespace cv;

int main(int argc, char** argv){
  Mat image;
  int xmin, ymin, xmax, ymax;

  CvPoint p;
  image = imread(argv[1],CV_LOAD_IMAGE_GRAYSCALE);
  if(!image.data){
    std::cout << "imagem nao carregou corretamente\n";
    return(-1);
  }
  xmin = atoi(argv[2]);
  ymin = atoi(argv[3]);
  xmax = atoi(argv[4]);
  ymax = atoi(argv[5]);
  
  if(xmin<0 || xmax>image.size().width || ymin<0 || ymax>image.size().height || xmax<xmin || ymax<ymin){
    std::cout << "Parâmetros inválidos, escolha pontos dentro da largura da imagem\n";
    return 0;
  }

  for(int i=xmin; i<xmax; i++){
    for(int j=ymin; j<ymax; j++){
      image.at<uchar>(i,j)=(unsigned char)(256-(int)image.at<uchar>(i,j));
    }
  }

  imshow("Processada", image);
  imwrite("negativo.png", image);
  
  waitKey();
  return 0;
}
----

E os comandos a serem usados para compilar e executar o exemplo podem ser vistos abaixo

```markdown
make regions
./regions biel.png 100 100 200 200
```
Usando como imagem de entrada o link:/imagens/biel.png[*_Biel_*]

image::/imagens/biel.png[]

e executando o programa, obtemos a imagem link:/imagens/negativo.png[*_Negativo_*] abaixo

image::/imagens/negativo.png[]

Para entender o código vamos observa-lo por parte:
O código possui uma parte onde inicializamos as variáveis a serem usadas, tenta abrir o arquivo de imagem e verifica se foi aberto com sucesso.

[source,cpp]
----
  Mat image;
  int xmin, ymin, xmax, ymax;

  CvPoint p;
  image = imread(argv[1],CV_LOAD_IMAGE_GRAYSCALE);
  if(!image.data){
    std::cout << "imagem nao carregou corretamente\n";
    return(-1);
  }
----

Após isso ele instancia as coordenadas dos vértices que definem o retângulo a ser negativado.

[source,cpp]
----
  xmin = atoi(argv[2]);
  ymin = atoi(argv[3]);
  xmax = atoi(argv[4]);
  ymax = atoi(argv[5]);
----

E então ele verifica a validade das coordenadas escolhidas

[source,cpp]
----
  if(xmin<0 || xmax>image.size().width || ymin<0 || ymax>image.size().height || xmax<xmin || ymax<ymin){
    std::cout << "Parâmetros inválidos, escolha pontos dentro da largura da imagem\n";
    return 0;
  }
----

E por fim, nesse trecho ele executa a negação para imprimir e salvar a imagem com a área negativada.

[source,cpp]
----
  for(int i=xmin; i<xmax; i++){
    for(int j=ymin; j<ymax; j++){
      image.at<uchar>(i,j)=(unsigned char)(256-(int)image.at<uchar>(i,j));
    }
  }
  
  imshow("Processada", image);
  imwrite("negativo.png", image);
----


== 3. Preenchimento de Regiões

=== 3.2. Exercício

==== 3.2.1 Labeling.cpp

Esse exercício consiste na contagem de bolhas com furos que não estão nas bordas da imagem. O número de bolhas e bolhas com furos é exibido no terminal. O exemplo usou a imagem das link:/imagens/bolhas.png[*_Bolhas_*] para conta-las.

O código fonte do programa pode ser visto abaixo: link:/codes/labeling.cpp[labeling.cpp]
